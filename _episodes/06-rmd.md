---
# Please do not edit this file directly; it is auto generated.
# Instead, please edit 06-rmd.md in _episodes_rmd/
title: "Reports with RMarkdown or "
teaching: 80
exercises: 35
questions:
  - "Why should you use RMarkdown to produce your manuscripts?"
  - "What are the advantages of using RMarkdown vs Word or LaTeX"
objectives:
   - "Become familiar with RMarkdown document structure"
   - "Use basic formating syntax"
   - "Learn to weave prose and code together"
keypoints:
   - "RMarkdown document change dynamically in response to changes in the data"
   - "RMarkdown lets you instantiate literally programming easily"
source: Rmd
---



# Acknowledgments

This lesson has been heavily influence by the Tobin Magle's presentation created for the [UW-Madison's Library Research Guides](https://researchguides.library.wisc.edu/R) entitled "Creating reproducible Research using R Markdown."

# Agenda

1.  Why should you write your reports using RMarkdown?
2.  What is literate programming? Why is it useful?
3.  Scenario: Using R Markdown to
  -   Format text
  -   Embed code
  -   Run Analyses
  -   Create Tables
  -   Create Plots
5.  Create your own document
6.  Ideas to organize your document 
7. Summary 
8. Where to find help

# Why you should write your reports using RMarkdown?

Rather than telling you why, I'm going to show you what the usual workflow for manuscript production in my field looks like. Then I'm going to show you what it looks like now that I have switched to writing exclusively in RMarkdown.

  1. collect data (interviews, recordings, corpora)
  2. code it into some type of data (tokens, measurements, categories)
  3. enter that into some computer software for analysis and visualizations
  4. write the prose in word processor  
  5. copy and paste the results from the analysis software
  6. import plots into the word processor
  7. changes in the data results into repeating steps 1-6

Sounds familiar? 
Can we do better?

## Anatomy of an RMarkdown document

# Literate programming

Human readable text + machine readable code = **reproducible** document

## Programs as work of literature

-   Idea by Donald Knuth, Stanford University.
-   A paradigm shift:

    -   **from** telling a computer what to do
    -   **to** telling a human what you want the computer to do

[Read More](http://www.literateprogramming.com/knuthweb.pdf)

## Literal Programming in Research

-   Tailor reports to an audience
-   Repeatable. Ensures reproducibility
-   Works well with version control
-   Works well with languages used in research.

## R, RStudio and RMarkdown

-   Weave your prose and code into one cohesive story

    -   R
    -   Python
    -   Stata
    -   SAS
    -   LaTeX

-   Produce document in many formats

-   Reproducible

# Scenario

**SAFI** (Studying African Farmer-Led Irrigation) is a study looking at farming and irrigation methods in _Tanzania_ and _Mozambique_. The survey data was collected through interviews conducted between November 2016 and June 2017. For this lesson, we will be using a subset of the available data. For information about the full teaching dataset used in other lessons in this workshop, see the [dataset](https://datacarpentry.org/socialsci-workshop/data/) description.


##  Install `markdown` packages (script vs IDE)



**Play with your document**
-   Click **knit**

##  Get the data


~~~
#interviews_plotting <- read_csv("data/interviews_plotting.csv")

#alternative way to get the dataset 
interviews_plotting <- read_csv(url("https://go.wisc.edu/5id64b"))
~~~
{: .language-r}



~~~

── Column specification ────────────────────────────────────────────────────────
cols(
  .default = col_logical(),
  key_ID = col_double(),
  village = col_character(),
  interview_date = col_datetime(format = ""),
  no_membrs = col_double(),
  years_liv = col_double(),
  respondent_wall_type = col_character(),
  rooms = col_double(),
  memb_assoc = col_character(),
  affect_conflicts = col_character(),
  liv_count = col_double(),
  no_meals = col_double(),
  instanceID = col_character(),
  number_months_lack_food = col_double(),
  number_items = col_double()
)
ℹ Use `spec()` for the full column specifications.
~~~
{: .output}



~~~
glimpse(interviews_plotting)
~~~
{: .language-r}



~~~
Rows: 131
Columns: 45
$ key_ID                  <dbl> 1, 1, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14,…
$ village                 <chr> "God", "God", "God", "God", "God", "God", "God…
$ interview_date          <dttm> 2016-11-17, 2016-11-17, 2016-11-17, 2016-11-1…
$ no_membrs               <dbl> 3, 7, 10, 7, 7, 3, 6, 12, 8, 12, 6, 7, 6, 10, …
$ years_liv               <dbl> 4, 9, 15, 6, 40, 3, 38, 70, 6, 23, 20, 20, 8, …
$ respondent_wall_type    <chr> "muddaub", "muddaub", "burntbricks", "burntbri…
$ rooms                   <dbl> 1, 1, 1, 1, 1, 1, 1, 3, 1, 5, 1, 3, 1, 3, 2, 1…
$ memb_assoc              <chr> "NULL", "yes", "NULL", "NULL", "NULL", "NULL",…
$ affect_conflicts        <chr> "NULL", "once", "NULL", "NULL", "NULL", "NULL"…
$ liv_count               <dbl> 1, 3, 1, 2, 4, 1, 1, 2, 3, 2, 2, 2, 3, 3, 3, 4…
$ no_meals                <dbl> 2, 2, 2, 2, 2, 2, 3, 2, 3, 3, 2, 3, 2, 3, 2, 3…
$ instanceID              <chr> "uuid:ec241f2c-0609-46ed-b5e8-fe575f6cefef", "…
$ bicycle                 <lgl> TRUE, TRUE, FALSE, TRUE, FALSE, FALSE, FALSE, …
$ television              <lgl> TRUE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE…
$ solar_panel             <lgl> TRUE, TRUE, FALSE, TRUE, FALSE, FALSE, FALSE, …
$ table                   <lgl> TRUE, TRUE, FALSE, FALSE, FALSE, FALSE, FALSE,…
$ cow_cart                <lgl> FALSE, TRUE, FALSE, FALSE, FALSE, FALSE, FALSE…
$ radio                   <lgl> FALSE, TRUE, FALSE, TRUE, TRUE, FALSE, FALSE, …
$ cow_plough              <lgl> FALSE, TRUE, FALSE, TRUE, TRUE, FALSE, TRUE, T…
$ solar_torch             <lgl> FALSE, TRUE, TRUE, FALSE, FALSE, FALSE, FALSE,…
$ mobile_phone            <lgl> FALSE, TRUE, FALSE, TRUE, TRUE, FALSE, FALSE, …
$ motorcyle               <lgl> FALSE, FALSE, FALSE, FALSE, TRUE, FALSE, TRUE,…
$ `NULL`                  <lgl> FALSE, FALSE, FALSE, FALSE, FALSE, TRUE, FALSE…
$ fridge                  <lgl> FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALS…
$ electricity             <lgl> FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALS…
$ sofa_set                <lgl> FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALS…
$ lorry                   <lgl> FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALS…
$ sterio                  <lgl> FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALS…
$ computer                <lgl> FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALS…
$ car                     <lgl> FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALS…
$ Jan                     <lgl> TRUE, TRUE, TRUE, FALSE, FALSE, FALSE, FALSE, …
$ Sept                    <lgl> FALSE, TRUE, FALSE, TRUE, TRUE, TRUE, FALSE, F…
$ Oct                     <lgl> FALSE, TRUE, TRUE, TRUE, TRUE, TRUE, FALSE, FA…
$ Nov                     <lgl> FALSE, TRUE, TRUE, TRUE, TRUE, FALSE, TRUE, FA…
$ Dec                     <lgl> FALSE, TRUE, TRUE, TRUE, FALSE, FALSE, FALSE, …
$ Feb                     <lgl> FALSE, FALSE, TRUE, FALSE, FALSE, FALSE, FALSE…
$ Mar                     <lgl> FALSE, FALSE, TRUE, FALSE, FALSE, FALSE, FALSE…
$ Aug                     <lgl> FALSE, FALSE, FALSE, FALSE, TRUE, TRUE, FALSE,…
$ June                    <lgl> FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALS…
$ July                    <lgl> FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALS…
$ Apr                     <lgl> FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALS…
$ May                     <lgl> FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALS…
$ none                    <lgl> FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALS…
$ number_months_lack_food <dbl> 1, 5, 6, 4, 4, 3, 1, 1, 2, 4, 2, 2, 3, 6, 11, …
$ number_items            <dbl> 4, 8, 1, 5, 4, 1, 2, 9, 3, 9, 2, 5, 4, 6, 5, 4…
~~~
{: .output}

##  Add some prose

The **SAFI** dataset contains data related to households and agriculture in _Tanzania_ and _Mozambique._ The survey covers things like:

- household features
- agricultural practices
- assets 
- details about the household members

**Play with your document**
-   Click **knit**

##  Weave some code into it to create a narrative

Let's imagine we want write a paragraph about the population per village. Which village is the most populated? Is it _Chirodzo_, _God_, or _Ruaca_. 

### Create a table


~~~
interviews_plotting %>% select(village, no_membrs) %>% 
  group_by(village) %>%
  summarize(population = sum(no_membrs))  
~~~
{: .language-r}



~~~
# A tibble: 3 x 2
  village  population
  <chr>         <dbl>
1 Chirodzo        276
2 God             295
3 Ruaca           371
~~~
{: .output}



~~~
# %>% 
# gt() %>% 
# tab_header(title = md("**Studying African Farmer-Led Irrigation**"), 
#             subtitle = md("Population _per village_"))
~~~
{: .language-r}

Of the three villages surveyed, Ruaca is the most populated with 371 people. The second-most populated village is God with 295 people. The least populated village in the sample is Chirodzo with 276. 

It would be ideal that the prose would be responsive to the data we just produced! We can do that easily within our document with inline code. 

First let store our results in an object, then let's access the object to get the results we want. 



###  Create a plot

Imagine now that we want to get an idea of 



## What's happening behind the scenes?


~~~
Error in include_graphics("fig/rmarkdownflow.png"): Cannot find the file(s): "fig/rmarkdownflow.png"
~~~
{: .error}


# Ideas to organize your reproducible document

-   Outline first, add code later
-   Use markdown syntax to structure and format your document \# headings \*\* **foldfacing**
-   [Check the cheatsheet](https://github.com/rstudio/cheatsheets/raw/master/rmarkdown-2.0.pdf)

# Summary
- Literate programming makes reproducible research more machine readable
- R markdown documents facilitate literate programming in RStudio
- R markdown has 3 sections
  -  Header: determines output and adds parameters
  -  Markdown Text: can include inline code
  -  Code chunks: can be customized to mute code or output

# Need help?
